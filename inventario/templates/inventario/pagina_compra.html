 <!DOCTYPE html>
 <html lang="es">
 <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo | Pañalera</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Tipografía predeterminada y fondo */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Fondo más claro y moderno */
        }
        /* Aplica una altura mínima al contenedor del producto para evitar saltos de diseño (CLS) */
        .product-card {
            min-height: 400px; 
        }
        .card-shadow {
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); /* Sombra más suave */
        }
        .text-colombian-price {
            color: #059669; /* Un tono de verde esmeralda para el precio */
        }
    </style>
</head>

<body class="min-h-screen flex flex-col">

    <!-- ... CÓDIGO INTERMEDIO SIN CAMBIOS ... -->
    
    <!-- Cambio 1: Eliminación del error de sintaxis de SonarQube y mejora del alt text -->
    <div class="container mx-auto p-6 flex-grow">
        <!-- ... CÓDIGO INTERMEDIO SIN CAMBIOS ... -->
        
        {% for producto in productos %}
            <div class="bg-white rounded-xl card-shadow overflow-hidden transition duration-300 hover:shadow-2xl flex flex-col product-card">
                <!-- Imagen del Producto / Placeholder -->
                <div class="bg-indigo-100 h-48 w-full flex items-center justify-center overflow-hidden">
                    {% if producto.imagen %}
                        <img 
                            src="{{ producto.imagen.url }}" 
                            alt="{{ producto.nombre }}"
                            class="object-cover w-full h-full"
                        >
                    {% else %}
                        <!-- Se eliminó el comentario incorrecto que estaba causando el error de sintaxis -->
                        <img 
                            src="https://placehold.co/400x200/6366f1/ffffff/png?text=Sin+Imagen" 
                            alt="Sin imagen de {{ producto.nombre }} disponible"
                            class="object-cover w-full h-full opacity-70"
                        >
                    {% endif %}
                </div>
                
                <!-- ... RESTO DE LA TARJETA DEL PRODUCTO SIN CAMBIOS ... -->
                
            </div>
            {% endfor %}
            
        <!-- ... CÓDIGO INTERMEDIO SIN CAMBIOS ... -->
    </div>


    <!-- Cambio 2: Actualización del footer por un color más moderno -->
    <footer class="bg-gray-200 p-4 text-center text-sm text-gray-700 mt-8">
         © 2025 Pañalera Project | Versión de Catálogo Público
    </footer>

    <!-- Cambio 3: Script mejorado con backoff exponencial para formateo de precios (mayor robustez) -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
             const priceElements = document.querySelectorAll('[data-price]');
            
            // Función para reintentar con backoff exponencial (para mayor robustez)
            function formatPriceWithRetry(element, maxRetries = 3, delay = 500) {
                const rawPrice = element.getAttribute('data-price');
                if (!rawPrice) return;

                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const number = parseInt(rawPrice);
                        // Usamos la configuración regional de Colombia ('es-CO') para el formato de miles y decimales
                        const formattedPrice = number.toLocaleString('es-CO');
                        element.textContent = `$ ${formattedPrice}`;
                        return; // Éxito, salir de la función
                    } catch (e) {
                        console.error(`Error formatting price. Retry ${i + 1}`, e);
                        // Esperar con backoff exponencial antes de reintentar
                        if (i < maxRetries - 1) {
                            setTimeout(() => {}, delay * Math.pow(2, i));
                        }
                    }
                }
                // Si falla después de todos los reintentos, mostrar el valor sin formato
                element.textContent = `$ ${rawPrice}`;
            }

            priceElements.forEach(element => {
                formatPriceWithRetry(element);
            });
        });
     </script>

</body>
</html>
